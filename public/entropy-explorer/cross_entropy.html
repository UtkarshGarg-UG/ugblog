<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Cross-Entropy — Minimal Demo</title>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<style>
  :root { --bg:#0b1320; --panel:#121a2a; --text:#e8eefc; --muted:#a6b0cf; --accent:#7aa2f7; --border:#1f2a44;}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial}
  .wrap{max-width:860px;margin:0 auto;padding:16px}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px;margin-top:12px}
  h1{font-size:22px;margin:0 0 6px}
  p{color:var(--muted);margin:8px 0}
  .controls{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .control{background:#0f1728;border:1px solid var(--border);border-radius:12px;padding:10px}
  label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
  input[type=range]{width:100%}
  .metrics{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;margin-top:10px}
  .metric{background:#0f1728;border:1px solid var(--border);border-radius:12px;padding:10px}
  .metric .val{font-weight:700}
  .tag{display:inline-block;padding:4px 8px;border-radius:999px;background:#0d203f;border:1px solid var(--border);color:var(--accent);font-size:12px}
  .small{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1>Cross-Entropy — Minimal Demo</h1>
  <p>
    Two-outcome toy (coin). Everything in <b>bits</b> (log base 2). Cross-entropy is
    <span class="tag">H(P,Q)=−[p·log₂(q) + (1−p)·log₂(1−q)]</span>.
  </p>

  <div class="panel controls">
    <div class="control">
      <label>True probability p = P(H)</label>
      <input id="pSlider" type="range" min="0" max="1" step="0.001" value="0.7" />
      <div class="small">P(H)=<b id="pVal">0.700</b>, P(T)=<b id="ptVal">0.300</b></div>
    </div>
    <div class="control">
      <label>Model probability q = Q(H)</label>
      <input id="qSlider" type="range" min="0" max="1" step="0.001" value="0.6" />
      <div class="small">Q(H)=<b id="qVal">0.600</b>, Q(T)=<b id="qtVal">0.400</b></div>
    </div>
  </div>

  <div class="panel">
    <div id="bars" style="height:260px;"></div>
    <p class="small">Bars show the true distribution P and the model Q over {H, T}.</p>
  </div>

  <div class="panel">
    <div id="codes" style="height:260px;"></div>
    <p class="small">
      Bars show code lengths <b>−log₂ Q(x)</b>. Shaded bars show weighted contributions
      <b>P(x)·(−log₂ Q(x))</b>; their sum is <b>H(P,Q)</b>.
    </p>
  </div>

  <div class="panel metrics">
    <div class="metric">
      <div class="small">Entropy H(P)</div>
      <div class="val" id="mH">–</div>
      <div class="small">= −[p·log₂ p + (1−p)·log₂(1−p)]</div>
    </div>
    <div class="metric">
      <div class="small">Cross-entropy H(P,Q)</div>
      <div class="val" id="mHX">–</div>
      <div class="small">= −[p·log₂ q + (1−p)·log₂(1−q)]</div>
    </div>
    <div class="metric">
      <div class="small">KL(P‖Q)</div>
      <div class="val" id="mKL">–</div>
      <div class="small">= H(P,Q) − H(P)</div>
    </div>
  </div>

  <p class="small">
    Intuition: The <b>log</b> comes from the scoring rule of the <b>model Q</b> (surprisal −log Q). The
    <b>P</b> weights come from how data are actually drawn. So we “score with Q, average under P.”
  </p>
</div>

<script>
(function(){
  const eps = 1e-12; // guard against log(0)
  const pSlider = document.getElementById('pSlider');
  const qSlider = document.getElementById('qSlider');
  const pVal = document.getElementById('pVal');
  const ptVal = document.getElementById('ptVal');
  const qVal = document.getElementById('qVal');
  const qtVal = document.getElementById('qtVal');
  const mH = document.getElementById('mH');
  const mHX = document.getElementById('mHX');
  const mKL = document.getElementById('mKL');

  function log2(x){ return Math.log(x) / Math.LN2; }

  function entropyP(p){
    const a = p>0 ? -p*log2(p) : 0;
    const b = (1-p)>0 ? -(1-p)*log2(1-p) : 0;
    return a+b;
  }
  function crossEntropyPQ(p,q){
    const a = -p*log2(Math.max(q,eps));
    const b = -(1-p)*log2(Math.max(1-q,eps));
    return a+b;
  }

  function fmt(x){ return (Math.round(x*1000)/1000).toFixed(3); }

  function draw() {
    const p = parseFloat(pSlider.value);
    const q = parseFloat(qSlider.value);
    pVal.textContent = fmt(p);
    ptVal.textContent = fmt(1-p);
    qVal.textContent = fmt(q);
    qtVal.textContent = fmt(1-q);

    // Metrics
    const H = entropyP(p);
    const HX = crossEntropyPQ(p,q);
    const KL = HX - H;
    mH.textContent = fmt(H) + ' bits';
    mHX.textContent = fmt(HX) + ' bits';
    mKL.textContent = fmt(KL) + ' bits';

    // Chart 1: P vs Q bars
    const traceP = {type:'bar', x:['H','T'], y:[p, 1-p], name:'P (true)', opacity:0.95};
    const traceQ = {type:'bar', x:['H','T'], y:[q, 1-q], name:'Q (model)', opacity:0.7};
    const layout1 = {
      barmode:'group', margin:{l:40,r:10,t:10,b:30},
      yaxis:{range:[0,1], tickformat:'.2f', gridcolor:'#18233a'},
      paper_bgcolor:'rgba(0,0,0,0)', plot_bgcolor:'rgba(0,0,0,0)',
      font:{color:'#e8eefc'}, legend:{orientation:'h',x:0,y:1.12}
    };
    Plotly.react('bars', [traceP, traceQ], layout1, {displayModeBar:false, responsive:true});

    // Chart 2: code lengths and weighted contributions
    const lenH = -log2(Math.max(q,eps));
    const lenT = -log2(Math.max(1-q,eps));
    const contribH = p * lenH;
    const contribT = (1-p) * lenT;
    const traceLen = {type:'bar', x:['H','T'], y:[lenH, lenT], name:'−log₂ Q(x)', opacity:0.9};
    const traceW = {type:'bar', x:['H','T'], y:[contribH, contribT], name:'P(x)·(−log₂ Q(x))', opacity:0.5};
    const ymax = Math.max(lenH, lenT, contribH, contribT) * 1.2;
    const layout2 = {
      barmode:'group', margin:{l:40,r:10,t:10,b:30},
      yaxis:{range:[0,Math.max(0.1,ymax)], gridcolor:'#18233a'},
      paper_bgcolor:'rgba(0,0,0,0)', plot_bgcolor:'rgba(0,0,0,0)',
      font:{color:'#e8eefc'}, legend:{orientation:'h',x:0,y:1.12},
      annotations: [{
        x:1.0, y:ymax*0.95, xref:'paper', yref:'y', showarrow:false,
        text:'H(P,Q) = ' + fmt(HX) + ' bits'
      }]
    };
    Plotly.react('codes', [traceLen, traceW], layout2, {displayModeBar:false, responsive:true});
  }

  pSlider.addEventListener('input', draw);
  qSlider.addEventListener('input', draw);
  draw();
})();
</script>
</body>
</html>
