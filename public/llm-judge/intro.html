<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Surgical Edit — Visual Intro</title>
<style>
  :root{
    --bg: #fafafa;
    --fg: #0f172a;
    --fg-muted: #475569;
    --fg-subtle: #94a3b8;
    --border: #e2e8f0;
    --border-strong: #cbd5e1;
    --surface: #ffffff;
    --surface-muted: #f8fafc;
    --accent: #3b82f6;
    --accent-light: #dbeafe;
    --accent-subtle: #eff6ff;
    --success: #10b981;
    --success-light: #d1fae5;
    --success-subtle: #ecfdf5;
    --warning: #f59e0b;
    --warning-light: #fef3c7;
    --danger: #ef4444;
    --danger-light: #fee2e2;
    --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
  }

  * { box-sizing: border-box; }

  html, body {
    margin: 0;
    padding: 0;
    background: var(--bg);
    color: var(--fg);
    font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
    padding: 32px 24px;
  }

  /* Header */
  .header {
    margin-bottom: 32px;
  }

  .title {
    font-size: 24px;
    font-weight: 700;
    margin: 0 0 8px 0;
    letter-spacing: -0.025em;
  }

  .subtitle {
    font-size: 15px;
    color: var(--fg-muted);
    margin: 0;
    line-height: 1.5;
  }

  /* Instruction Card */
  .instruction-card {
    background: linear-gradient(135deg, var(--accent-subtle) 0%, var(--surface) 100%);
    border: 1px solid var(--accent-light);
    border-radius: 16px;
    padding: 20px 24px;
    margin-bottom: 24px;
    box-shadow: var(--shadow-sm);
  }

  .instruction-label {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--accent);
    margin-bottom: 8px;
  }

  .instruction-text {
    font-size: 16px;
    font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Courier New', monospace;
    color: var(--fg);
    font-weight: 500;
  }

  /* Controls */
  .controls {
    display: flex;
    gap: 12px;
    margin-bottom: 32px;
    align-items: center;
  }

  button {
    padding: 10px 20px;
    border: 1px solid var(--border-strong);
    border-radius: 10px;
    background: var(--surface);
    color: var(--fg);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: var(--shadow-sm);
  }

  button:hover {
    border-color: var(--accent);
    color: var(--accent);
    box-shadow: var(--shadow);
  }

  button.primary {
    background: var(--accent);
    color: white;
    border-color: var(--accent);
  }

  button.primary:hover {
    background: #2563eb;
    border-color: #2563eb;
    box-shadow: var(--shadow-md);
  }

  button:active {
    transform: translateY(1px);
  }

  /* Progress Indicator */
  .progress-bar {
    height: 6px;
    background: var(--border);
    border-radius: 999px;
    overflow: hidden;
    margin-bottom: 24px;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--success));
    border-radius: 999px;
    width: 0%;
    transition: width 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Main Layout */
  .layout {
    display: grid;
    grid-template-columns: 1.2fr 0.8fr;
    gap: 24px;
  }

  @media (max-width: 768px) {
    .layout {
      grid-template-columns: 1fr;
    }
  }

  /* Document Panel */
  .document-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    box-shadow: var(--shadow);
  }

  .toc-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    border-radius: 6px;
    background: var(--success-light);
    color: #065f46;
    font-size: 12px;
    font-weight: 700;
    border: 1px solid var(--success);
    margin-bottom: 12px;
  }

  .toc {
    font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
    font-size: 13px;
    color: var(--fg-muted);
    padding: 16px;
    background: var(--surface-muted);
    border-radius: 10px;
    margin-bottom: 24px;
    border: 1px solid var(--border);
    line-height: 1.8;
  }

  .section {
    margin-bottom: 20px;
    padding: 16px;
    border-radius: 10px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .section-title {
    font-size: 18px;
    font-weight: 700;
    margin: 0 0 12px 0;
    display: flex;
    align-items: baseline;
    gap: 8px;
  }

  .section-number {
    color: var(--accent);
    font-weight: 800;
    transition: all 0.3s ease;
  }

  .section-text {
    margin: 0;
    color: var(--fg-muted);
    font-size: 15px;
    line-height: 1.6;
  }

  .xref {
    font-family: 'SF Mono', Monaco, monospace;
    font-size: 13px;
    padding: 2px 6px;
    background: var(--accent-light);
    color: var(--accent);
    border-radius: 4px;
    font-weight: 600;
  }

  /* Status Log */
  .status-log {
    margin-top: 24px;
    padding: 16px;
    background: var(--surface-muted);
    border-radius: 10px;
    border-left: 4px solid var(--accent);
    font-size: 14px;
    color: var(--fg-muted);
    font-weight: 500;
    transition: all 0.3s ease;
  }

  .status-log.ok {
    border-color: var(--success);
    background: var(--success-subtle);
    color: #065f46;
  }

  .status-log.warn {
    border-color: var(--warning);
    background: var(--warning-light);
    color: #92400e;
  }

  /* Legend Panel */
  .legend-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 24px;
    box-shadow: var(--shadow);
    height: fit-content;
    position: sticky;
    top: 24px;
  }

  .legend-title {
    font-size: 16px;
    font-weight: 700;
    margin: 0 0 16px 0;
    color: var(--fg);
  }

  .legend-list {
    margin: 0 0 24px 0;
    padding-left: 20px;
    color: var(--fg-muted);
    font-size: 14px;
  }

  .legend-list li {
    margin-bottom: 8px;
    line-height: 1.5;
  }

  .legend-list strong {
    color: var(--fg);
    font-weight: 600;
  }

  .legend-section {
    margin-bottom: 20px;
  }

  .legend-section:last-child {
    margin-bottom: 0;
  }

  .legend-badge {
    display: inline-flex;
    align-items: center;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 12px;
    font-weight: 700;
    margin-bottom: 12px;
  }

  .legend-badge.success {
    background: var(--success-light);
    color: #065f46;
    border: 1px solid var(--success);
  }

  .legend-badge.danger {
    background: var(--danger-light);
    color: #7f1d1d;
    border: 1px solid var(--danger);
  }

  .legend-items {
    margin: 0;
    padding-left: 20px;
    font-size: 13px;
  }

  .legend-items.success {
    color: #065f46;
  }

  .legend-items.danger {
    color: #7f1d1d;
  }

  .legend-items li {
    margin-bottom: 4px;
  }

  /* Animations */
  .highlight {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(59, 130, 246, 0.02));
    border: 2px solid var(--accent-light);
  }

  .pulse {
    animation: pulse 0.8s cubic-bezier(0.4, 0, 0.6, 1);
  }

  @keyframes pulse {
    0%, 100% {
      box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
    }
    50% {
      box-shadow: 0 0 0 12px rgba(59, 130, 246, 0);
    }
  }

  .shrink {
    animation: shrink 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }

  @keyframes shrink {
    0% {
      opacity: 1;
      transform: scaleY(1);
      max-height: 200px;
      margin-bottom: 20px;
    }
    100% {
      opacity: 0;
      transform: scaleY(0);
      max-height: 0;
      margin-bottom: 0;
      padding-top: 0;
      padding-bottom: 0;
    }
  }

  .fade-in {
    animation: fadeIn 0.4s ease-in;
  }

  @keyframes fadeIn {
    from {
      opacity: 0.3;
    }
    to {
      opacity: 1;
    }
  }

  .number-change {
    animation: numberChange 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  @keyframes numberChange {
    0% {
      background: var(--warning-light);
      transform: scale(1.2);
    }
    100% {
      background: transparent;
      transform: scale(1);
    }
  }

  .ref-flash {
    animation: refFlash 0.6s ease;
  }

  @keyframes refFlash {
    0%, 100% {
      background: var(--accent-light);
      color: var(--accent);
    }
    50% {
      background: var(--warning-light);
      color: #92400e;
      transform: scale(1.05);
    }
  }

  .strike {
    text-decoration: line-through;
    opacity: 0.5;
  }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1 class="title">Context-Aware Editing: The Precision Paradox</h1>
    <p class="subtitle">
      My first "precision" metric penalized the agent for making <em>any</em> changes beyond the exact deletion. But when the agent intelligently updated the TOC, renumbered sections, and fixed cross-references—all necessary to keep the document consistent—the metric gave it a score of 0. I was punishing exactly the smart, context-aware behavior I wanted. This demo shows what "precision" should actually mean.
    </p>
  </div>

  <div class="instruction-card">
    <div class="instruction-label">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
      </svg>
      User Instruction
    </div>
    <div class="instruction-text">
      "Delete <strong>Section 2: Methods</strong>. Keep document consistent."
    </div>
  </div>

  <div class="controls">
    <button id="playBtn" class="primary">
      <span>▶ Play Demo</span>
    </button>
    <button id="stepBtn">Step Forward</button>
    <button id="resetBtn">Reset</button>
  </div>

  <div class="progress-bar">
    <div id="progressFill" class="progress-fill"></div>
  </div>

  <div class="layout">
    <!-- Document Panel -->
    <div class="document-panel">
      <div class="toc-badge">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
          <polyline points="9 11 12 14 22 4"></polyline>
          <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
        </svg>
        Table of Contents
      </div>

      <div id="toc" class="toc">
        1. Introduction • 2. Methods • 3. Results • 4. Conclusion
      </div>

      <div id="sec1" class="section">
        <h2 class="section-title">
          <span class="section-number">1.</span>
          <span>Introduction</span>
        </h2>
        <p class="section-text">
          This study explores a simple edit. See <span id="xref" class="xref">Section 3</span> for results.
        </p>
      </div>

      <div id="sec2" class="section">
        <h2 class="section-title">
          <span class="section-number">2.</span>
          <span>Methods</span>
        </h2>
        <p class="section-text">
          We describe procedures here.
        </p>
      </div>

      <div id="sec3" class="section">
        <h2 class="section-title">
          <span id="num3" class="section-number">3.</span>
          <span>Results</span>
        </h2>
        <p class="section-text">
          Primary findings summarized below.
        </p>
      </div>

      <div id="sec4" class="section">
        <h2 class="section-title">
          <span id="num4" class="section-number">4.</span>
          <span>Conclusion</span>
        </h2>
        <p class="section-text">
          Takeaways and next steps.
        </p>
      </div>

      <div id="statusLog" class="status-log">
        Ready to begin. Click "Play Demo" or "Step Forward" to start.
      </div>
    </div>

    <!-- Legend Panel -->
    <div class="legend-panel">
      <h3 class="legend-title">What to Watch</h3>
      <ol class="legend-list">
        <li><strong>Target highlight</strong> — Section 2 gets marked for deletion</li>
        <li><strong>Precise deletion</strong> — Only Section 2 disappears</li>
        <li><strong>Auto-renumber</strong> — Sections 3→2, 4→3</li>
        <li><strong>TOC sync</strong> — Table of contents updates automatically</li>
        <li><strong>Cross-ref fix</strong> — "Section 3" reference becomes "Section 2"</li>
        <li><strong>No extras</strong> — All other content stays untouched</li>
      </ol>

      <div class="legend-section">
        <div class="legend-badge success">✓ Allowed Side-Effects</div>
        <ul class="legend-items success">
          <li>TOC synchronization</li>
          <li>Section renumbering</li>
          <li>Cross-reference updates</li>
          <li>Structure consistency fixes</li>
        </ul>
      </div>

      <div class="legend-section">
        <div class="legend-badge danger">✗ Not Allowed</div>
        <ul class="legend-items danger">
          <li>Rewriting other sections</li>
          <li>Changing voice or style</li>
          <li>Adding marketing copy</li>
          <li>Unrelated edits</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  // Elements
  const toc = document.getElementById('toc');
  const sec1 = document.getElementById('sec1');
  const sec2 = document.getElementById('sec2');
  const sec3 = document.getElementById('sec3');
  const sec4 = document.getElementById('sec4');
  const xref = document.getElementById('xref');
  const num3 = document.getElementById('num3');
  const num4 = document.getElementById('num4');
  const statusLog = document.getElementById('statusLog');
  const progressFill = document.getElementById('progressFill');

  const playBtn = document.getElementById('playBtn');
  const stepBtn = document.getElementById('stepBtn');
  const resetBtn = document.getElementById('resetBtn');

  // State
  let currentStep = 0;
  let isPlaying = false;
  let playTimer = null;

  const steps = [
    {
      action: highlightTarget,
      message: "Step 1: Target identified — Section 2: Methods marked for deletion",
      progress: 16
    },
    {
      action: deleteTarget,
      message: "Step 2: Precise deletion — Removing only the target section",
      progress: 33
    },
    {
      action: renumberSections,
      message: "Step 3: Auto-renumbering — Updating section numbers (3→2, 4→3)",
      progress: 50
    },
    {
      action: updateTOC,
      message: "Step 4: TOC synchronization — Table of contents reflects new structure",
      progress: 66
    },
    {
      action: updateCrossRef,
      message: "Step 5: Cross-reference update — Fixing reference (Section 3 → Section 2)",
      progress: 83
    },
    {
      action: showComplete,
      message: "Step 6: Complete — All necessary updates applied. No unrelated edits made.",
      progress: 100
    }
  ];

  function updateStatus(message, type = '') {
    statusLog.textContent = message;
    statusLog.className = 'status-log';
    if (type) statusLog.classList.add(type);
  }

  function updateProgress(percent) {
    progressFill.style.width = percent + '%';
  }

  // Step Actions
  function highlightTarget() {
    sec2.classList.add('highlight', 'pulse');
  }

  function deleteTarget() {
    sec2.classList.remove('pulse');
    sec2.classList.add('shrink');
    setTimeout(() => {
      sec2.style.display = 'none';
    }, 500);
  }

  function renumberSections() {
    num3.textContent = '2.';
    num3.classList.add('number-change');
    num4.textContent = '3.';
    num4.classList.add('number-change');

    setTimeout(() => {
      num3.classList.remove('number-change');
      num4.classList.remove('number-change');
    }, 600);
  }

  function updateTOC() {
    toc.textContent = '1. Introduction • 2. Results • 3. Conclusion';
    toc.classList.add('fade-in');
    setTimeout(() => toc.classList.remove('fade-in'), 400);
  }

  function updateCrossRef() {
    xref.classList.add('ref-flash');
    setTimeout(() => {
      xref.textContent = 'Section 2';
      setTimeout(() => xref.classList.remove('ref-flash'), 300);
    }, 300);
  }

  function showComplete() {
    sec3.classList.add('fade-in');
    sec4.classList.add('fade-in');
    setTimeout(() => {
      sec3.classList.remove('fade-in');
      sec4.classList.remove('fade-in');
    }, 400);
  }

  // Controls
  function doStep() {
    if (currentStep >= steps.length) {
      updateStatus('Demo complete! Click Reset to watch again.', 'warn');
      isPlaying = false;
      return;
    }

    const step = steps[currentStep];
    step.action();
    updateStatus(step.message, 'ok');
    updateProgress(step.progress);
    currentStep++;

    if (currentStep >= steps.length) {
      isPlaying = false;
    }
  }

  function play() {
    if (isPlaying) return;
    if (currentStep >= steps.length) reset();

    isPlaying = true;

    const tick = () => {
      if (!isPlaying || currentStep >= steps.length) {
        isPlaying = false;
        return;
      }

      doStep();
      playTimer = setTimeout(tick, 1200);
    };

    tick();
  }

  function reset() {
    isPlaying = false;
    clearTimeout(playTimer);
    currentStep = 0;

    // Reset all elements
    sec2.className = 'section';
    sec2.style.display = 'block';
    sec1.className = 'section';
    sec3.className = 'section';
    sec4.className = 'section';

    num3.textContent = '3.';
    num4.textContent = '4.';

    toc.textContent = '1. Introduction • 2. Methods • 3. Results • 4. Conclusion';
    xref.textContent = 'Section 3';

    updateStatus('Ready to begin. Click "Play Demo" or "Step Forward" to start.');
    updateProgress(0);
  }

  // Event Listeners
  playBtn.addEventListener('click', play);
  stepBtn.addEventListener('click', doStep);
  resetBtn.addEventListener('click', reset);

  // Auto-play on page load
  let hasAutoPlayed = false;
  let shouldLoop = true;

  window.addEventListener('load', () => {
    if (!hasAutoPlayed) {
      hasAutoPlayed = true;
      // Auto-play after a short delay
      setTimeout(() => {
        play();
      }, 800);
    }
  });

  // Modified play function to support looping
  const originalPlay = play;
  play = function() {
    if (isPlaying) return;
    if (currentStep >= steps.length) reset();

    isPlaying = true;

    const tick = () => {
      if (!isPlaying || currentStep >= steps.length) {
        isPlaying = false;

        // Auto-loop: restart after completion
        if (currentStep >= steps.length && shouldLoop) {
          setTimeout(() => {
            reset();
            setTimeout(() => play(), 1000);
          }, 2000); // Wait 2 seconds before looping
        }
        return;
      }

      doStep();
      playTimer = setTimeout(tick, 1200);
    };

    tick();
  };

  // Initialize
  reset();
})();
</script>
</body>
</html>
